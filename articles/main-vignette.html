<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Analyzing population genomic data with tess3r. tess3r</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container">
      <header><div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">tess3r</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/main-vignette.html">Overview</a>
</li>
<li>
  <a href="../reference/index.html">Documentation</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/BioShock38/TESS3_encho_sen">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Analyzing population genomic data with tess3r</h1>
                        <h4 class="author">Kevin Caye - Flora Jay - Olivier Fran&ccedil;ois</h4>
            
            <h4 class="date">2016-10-13</h4>
          </div>

    
    
<hr><p><strong>Summary:</strong> Geography is one of the most important determinant of genetic variation in natural populations. Using genotypic and geographic data, the R package <strong>tess3r</strong> provides estimates of population genetic structure and tools for screening genomes for signatures of natural selection.</p>
<p>The main function <strong>tess3</strong> computes estimates of ancestry proportions and ancestral allele frequencies. The package contains functions that handle geographic maps, and allows users to display spatial representations of ancestry coefficients on those maps. In addition, <strong>tess3r</strong> performs genome scans for selection by separating adaptive from nonadaptive genetic variation based on allele frequency differentiation tests. Based on matrix factorization algorithms, the <strong>tess3r</strong> package is parcularly suitable for analyzing large genomic data sets having thousands of markers and samples.</p>
<hr><div id="introduction" class="section level4">
<h4>Introduction</h4>
<p>Estimating and visualizing population genetic structure is commonly achieved through algorithms such as the well-known STRUCTURE, TESS, ADMIXTURE methods (Pritchard et al. 2000, Chen et al. 2007, Alexander et al. 2009), and with more recent sparse nonnegative matrix factorization approaches (sNMF, Frichot et al. 2014). All these programs estimate proportions of individual genomes originating from K ancestral populations (individual ancestry coefficients), and the corresponding ancestral genotype frequencies.</p>
<p>Population genetic structure analysis includes three main steps:</p>
<ol style="list-style-type: decimal"><li><p>running one (or more) of the above inference algorithms,</p></li>
<li><p>choosing the number of ancestral populations or genetic clusters,</p></li>
<li><p>showing bar-plots of ancestry coefficients or displaying them on geographic maps.</p></li>
</ol><p>This vignette presents a brief tutorial on how to use the R package <strong>tess3r</strong> to perform all those analyses within a unique framework. The program stores ancestry coefficients in a <span class="math inline">\(Q\)</span>-matrix, and uses geographic coordinates to visualize results. The algorithm implements a new version of the program TESS (Chen et al. 2007), based on geographically constrained matrix factorization and quadratic programming techniques (Caye et al. 2016). The new algorithms are several order faster than the Monte-Carlo algorithms implemented in previous versions of TESS, and can handle data sets including hundreds of individuals and hundreds of thousands of genotypes. The package can also be used to analyze the input and output files of the Bayesian program TESS 2.3.</p>
<p>The main steps of <strong>tess3r</strong> are illustrated through the description of two examples. The first example concerns single nucleotide polymorphism (SNP) data for 170 European accessions of the plant species <em>A. thaliana</em> (Atwell et al. 2010). The second example concerns simulated allelic markers (short tandem repeats, STR) for two subspecies hybridizing in Central Europe (Durand et al. 2009).</p>
<p>The next paragraphs will guide users through each step of analysis, making the operations easily reproducible within their computing environment. To start an R session with <strong>tess3r</strong>, use the following command:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tess3r)</code></pre></div>
</div>
<div id="snp-data" class="section level4">
<h4>SNP data</h4>
<div id="data-files" class="section level5">
<h5>Data files</h5>
<p>Running the main function <strong>tess3</strong> requires two files as input to the program: 1) a file encoding individual genotypes, and 2) a file with individual geographic coordinates. Consider SNP data from the plant species <em>A. thaliana</em> in Europe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(data.at)
genotype =<span class="st"> </span>data.at$X
coordinates =<span class="st"> </span>data.at$coord</code></pre></div>
<p>For SNPs, the <strong>genotype</strong> matrix encodes individual genotype as rows. Each locus corresponds to a specific column. Genotypes are encoded as 0,1,2 for diploids, and 0,1 for haploids. Those numbers represent the number of reference or derived allele at each particular locus. <em>A. thaliana</em> is a diploid species with very high levels of inbreeding. In our example, 170 genotypes were encoded as haploid (26,943 loci). Let&rsquo;s print the genotypes for the first 3 individuals at 10 loci. We have a matrix with 0 and 1 values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(genotype)</code></pre></div>
<pre><code>## [1]   170 26943</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">genotype[<span class="dv">1</span>:<span class="dv">3</span>,<span class="dv">1</span>:<span class="dv">10</span>]</code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
## [1,]    0    1    1    1    1    1    1    0    1     1
## [2,]    0    1    1    1    1    1    1    0    1     1
## [3,]    0    1    0    1    1    1    1    1    1     1</code></pre>
<p>The genotype file can be read from an external text file having any suffix. The matrix format also corresponds to the <strong>.lfmm</strong> format in the <strong>LEA</strong> package (Frichot and Francois, 2015), which contains functions to convert data files from the <strong>.ped</strong>, <strong>.vcf</strong> or <strong>.geno</strong> format into genotypic matrices.</p>
<p>The <strong>coordinate</strong> file is a two-column file that contains longitude and latitude for each individual in the sample. Longitude (&deg;E) and latitude (&deg;N) must be encoded in the decimal format. Headers must be ignored when loading the data into the R program.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(maps)
coordinates[<span class="dv">1</span>:<span class="dv">3</span>,]</code></pre></div>
<pre><code>##             V1       V2
## [1,] 25.154552 54.39078
## [2,] -8.429345 40.19713
## [3,] 13.511291 55.85332</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(coordinates, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">cex =</span> .<span class="dv">5</span>, 
     <span class="dt">xlab =</span> <span class="st">"Longitude (&deg;E)"</span>, <span class="dt">ylab =</span> <span class="st">"Latitude (&deg;N)"</span>)
<span class="kw">map</span>(<span class="dt">add =</span> T, <span class="dt">interior =</span> F)</code></pre></div>
<p><img src="/home/cayek/KrakenatorHomeDir/Projects/TESS3_encho_sen/docs/articles/main-vignette_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
</div>
<div id="estimating-ancestry-coefficients" class="section level5">
<h5>Estimating ancestry coefficients</h5>
<p>The main function of the <strong>tess3r</strong> package is the <strong>tess3</strong> function. This function creates an object of class <strong>tess3</strong> which contains the results of one or several runs of the estimation algorithm. For example, running the program for ancestral populations numbers ranging from <span class="math inline">\(K = 1\)</span> to <span class="math inline">\(K = 8\)</span> using 4 CPUs can be programmed as follows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tess3.obj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/tess3.html">tess3</a></span>(<span class="dt">X =</span> genotype, <span class="dt">coord =</span> coordinates, <span class="dt">K =</span> <span class="dv">1</span>:<span class="dv">8</span>, 
                   <span class="dt">method =</span> <span class="st">"projected.ls"</span>, <span class="dt">ploidy =</span> <span class="dv">1</span>, <span class="dt">openMP.core.num =</span> <span class="dv">4</span>) </code></pre></div>
<p>The <strong>X</strong> argument refers to the genotype matrix, the <strong>coord</strong> argument corresponds to the geographic coordinates, <strong>K</strong> is the number of clusters or ancestral populations, and <strong>openMP.core.num</strong> is the number of processes used by the multi-threaded program.</p>
<p>The <strong>plot</strong> function generates a plot for root mean-squared errors computed on a subset of loci used for cross-validation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(tess3.obj, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="st">"blue"</span>,
     <span class="dt">xlab =</span> <span class="st">"Number of ancestral populations"</span>,
     <span class="dt">ylab =</span> <span class="st">"Cross-validation score"</span>)</code></pre></div>
<p><img src="/home/cayek/KrakenatorHomeDir/Projects/TESS3_encho_sen/docs/articles/main-vignette_files/figure-html/rmse.plot-1.png" width="672"></p>
<p>The interpretation of this plot is similar to the <em>cross-entropy</em> plot of <strong>LEA</strong> or the <em>cross-validation</em> plot of ADMIXTURE. The cross-validation criterion is based on the prediction of a fraction of masked genotypes via matrix completion, and comparison with masked values considered as the truth. Smaller values of the cross-validation criterion mean better runs. The best choice for the <span class="math inline">\(K\)</span> value is when the cross-validation curve exhibits a plateau or starts increasing.</p>
<p><strong>Warning:</strong> Be cautious about over-interpreting the value of <span class="math inline">\(K\)</span> and the folkore around the choice of this value. Population structure is often hierarchical, and the estimation of <span class="math inline">\(K\)</span> strongly depends on sampling and genotyping efforts. The number of genetic groups detected by ancestry estimation programs does not necessarily correspond to the number of biologically meaningful populations in the sample (Francois and Durand 2010).</p>
<p>Looking at the results for the <em>A. thaliana</em> data set, the cross-validation criterion does not exhibit a minimum value or a plateau. The result indicates that there are 3 major clusters in Europe, and that finer levels of population structure could be detected.</p>
</div>
<div id="visualizing-the-results" class="section level5">
<h5>Visualizing the results</h5>
<p>Next, we want to display the <span class="math inline">\(Q\)</span>-matrix for <span class="math inline">\(K = 5\)</span> clusters using a barplot representation. For this representation, we use the <strong>barplot</strong> function of the package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># retrieve tess3 Q matrix for K = 5 clusters </span>
q.matrix &lt;-<span class="st"> </span><span class="kw"><a href="../reference/qmatrix.html">qmatrix</a></span>(tess3.obj, <span class="dt">K =</span> <span class="dv">5</span>)
<span class="co"># STRUCTURE-like barplot for the Q-matrix </span>
<span class="kw">barplot</span>(q.matrix, <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">space =</span> <span class="dv">0</span>, 
        <span class="dt">xlab =</span> <span class="st">"Individuals"</span>, <span class="dt">ylab =</span> <span class="st">"Ancestry proportions"</span>, 
        <span class="dt">main =</span> <span class="st">"Ancestry matrix"</span>) -&gt;<span class="st"> </span>bp</code></pre></div>
<pre><code>## Use CreatePalette() to define color palettes.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at =</span> <span class="dv">1</span>:<span class="kw">nrow</span>(q.matrix), <span class="dt">labels =</span> bp$order, <span class="dt">las =</span> <span class="dv">3</span>, <span class="dt">cex.axis =</span> .<span class="dv">4</span>) </code></pre></div>
<p><img src="/home/cayek/KrakenatorHomeDir/Projects/TESS3_encho_sen/docs/articles/main-vignette_files/figure-html/Q.plot-1.png" width="672"></p>
<p>The <strong>barplot</strong> function is very similar to the default method of the <strong>graphics</strong> library of R. It contains a &lsquo;sort-by-Q&rsquo; option, and allows color palettes to be used. To change the colors, use the <strong>CreatePalette</strong> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my.colors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"tomato"</span>, <span class="st">"orange"</span>, <span class="st">"lightblue"</span>, <span class="st">"wheat"</span>,<span class="st">"olivedrab"</span>)
my.palette &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CreatePalette.html">CreatePalette</a></span>(my.colors, <span class="dv">9</span>)
<span class="kw">barplot</span>(q.matrix, <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">space =</span> <span class="dv">0</span>, 
        <span class="dt">main =</span> <span class="st">"Ancestry matrix"</span>, 
        <span class="dt">xlab =</span> <span class="st">"Individuals"</span>, <span class="dt">ylab =</span> <span class="st">"Ancestry proportions"</span>, 
        <span class="dt">col.palette =</span> my.palette) -&gt;<span class="st"> </span>bp
<span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at =</span> <span class="dv">1</span>:<span class="kw">nrow</span>(q.matrix), <span class="dt">labels =</span> bp$order, <span class="dt">las =</span> <span class="dv">3</span>, <span class="dt">cex.axis =</span> .<span class="dv">4</span>) </code></pre></div>
<p><img src="/home/cayek/KrakenatorHomeDir/Projects/TESS3_encho_sen/docs/articles/main-vignette_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>The <strong>plot</strong> function interpolates the values of the <span class="math inline">\(Q\)</span>-matrix on a geographic map. The map can be infered from the sample coordinates, or it can be provided to the program in a raster format or a <code>sp::SpatialPolygonsDataFrame</code> object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(q.matrix, coordinates, <span class="dt">method =</span> <span class="st">"map.max"</span>, <span class="dt">interpol =</span> <span class="kw"><a href="../reference/FieldsKrigModel.html">FieldsKrigModel</a></span>(<span class="dv">10</span>),  
     <span class="dt">main =</span> <span class="st">"Ancestry coefficients"</span>,
     <span class="dt">xlab =</span> <span class="st">"Longitude"</span>, <span class="dt">ylab =</span> <span class="st">"Latitude"</span>, 
     <span class="dt">resolution =</span> <span class="kw">c</span>(<span class="dv">500</span>,<span class="dv">500</span>), <span class="dt">cex =</span> .<span class="dv">4</span>, 
     <span class="dt">col.palette =</span> my.palette)</code></pre></div>
<p><img src="/home/cayek/KrakenatorHomeDir/Projects/TESS3_encho_sen/docs/articles/main-vignette_files/figure-html/map.plot-1.png" width="672"></p>
<p>The plot function uses a default world map provide by the function <code>rworldmap::getMap()</code>. For more acurate map, any raster file could be used. For example, a raster map of Europe can be downloaded and used as follows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">asc.raster &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
<span class="kw">download.file</span>(<span class="st">"http://membres-timc.imag.fr/Olivier.Francois/RasterMaps/Europe.asc"</span>, asc.raster)
<span class="kw">plot</span>(q.matrix, coordinates, <span class="dt">method =</span> <span class="st">"map.max"</span>, <span class="dt">cex =</span> .<span class="dv">4</span>,  
     <span class="dt">interpol =</span> <span class="kw"><a href="../reference/FieldsKrigModel.html">FieldsKrigModel</a></span>(<span class="dv">10</span>), 
     <span class="dt">raster.filename =</span> asc.raster,
     <span class="dt">main =</span> <span class="st">"Ancestry coefficients"</span>,
     <span class="dt">xlab =</span> <span class="st">"Longitude"</span>, <span class="dt">ylab =</span> <span class="st">"Latitude"</span>, 
     <span class="dt">col.palette =</span> my.palette)</code></pre></div>
<p><img src="/home/cayek/KrakenatorHomeDir/Projects/TESS3_encho_sen/docs/articles/main-vignette_files/figure-html/map.plot.raster-1.png" width="672"></p>
<p>For <code>ggplot2</code> enthusiasts, the package provides a function which returns a <code>ggplot</code> layer.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(rworldmap)

map.polygon &lt;-<span class="st"> </span><span class="kw">getMap</span>(<span class="dt">resolution =</span> <span class="st">"low"</span>)

pl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ggtess3Q.html">ggtess3Q</a></span>(q.matrix, coordinates, <span class="dt">map.polygon =</span> map.polygon)
pl +
<span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> map.polygon, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) +
<span class="st">  </span><span class="kw">xlim</span>(-<span class="dv">16</span>, <span class="dv">42</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">ylim</span>(<span class="dv">35</span>, <span class="dv">65</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">coord_equal</span>() +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">as.data.frame</span>(coordinates), <span class="kw">aes</span>(<span class="dt">x =</span> V1, <span class="dt">y =</span> V2), <span class="dt">size =</span> <span class="fl">0.2</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Longitute"</span>) +
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">"Latitude"</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="/home/cayek/KrakenatorHomeDir/Projects/TESS3_encho_sen/docs/articles/main-vignette_files/figure-html/map.ggplot2-1.png" width="672"></p>
</div>
<div id="genome-scans-for-selection" class="section level5">
<h5>Genome scans for selection</h5>
<p>Another feature of the <strong>tess3r</strong> packages is to allow users to scan the genomic data for outlier loci. The genome scan method implemented in the package is a Fst approach. The function compares single-locus estimates of a population differentiation statistic with the genome-wide background. Then, it converts those estimates into statistical significance values after recalibration of the null-hypothesis (Martins et al. 2016, Francois et al. 2016).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># retrieve tess3 results for K = 5 </span>
p.values &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pvalue.html">pvalue</a></span>(tess3.obj, <span class="dt">K =</span> <span class="dv">5</span>)</code></pre></div>
<p>Whether the tests are correctly calibrated can be checked by inspecting the histogram of <span class="math inline">\(p\)</span>-values. Ideally, the histogram should be flat and show a peak close to zero.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(p.values, <span class="dt">col =</span> <span class="st">"lightblue"</span>) </code></pre></div>
<p><img src="/home/cayek/KrakenatorHomeDir/Projects/TESS3_encho_sen/docs/articles/main-vignette_files/figure-html/G.plot1b-1.png" width="672"></p>
<p>When the histogram has the correct shape, lists of outlier loci can be derived from standard False Discovery Rate (FDR) control algorithms. This can be done by using a classic Benjamini-Hochberg correction as follows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Benjamini-Hochberg algorithm</span>
L =<span class="st"> </span><span class="kw">length</span>(p.values)
fdr.level =<span class="st"> </span><span class="fl">1e-4</span>
w =<span class="st"> </span><span class="kw">which</span>(<span class="kw">sort</span>(p.values) &lt;<span class="st"> </span>fdr.level *<span class="st"> </span>(<span class="dv">1</span>:L)/L)
candidates =<span class="st"> </span><span class="kw">order</span>(p.values)[w]
<span class="kw">length</span>(candidates)</code></pre></div>
<pre><code>## [1] 467</code></pre>
<p>A list of candidate loci with an expected FDR level of <span class="math inline">\(0.0001\)</span> is recorded in the object <strong>candidates</strong>. A &lsquo;Manhattan&rsquo; plot highlighting the candidate loci in blue color is then generated as follows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># manhattan plot </span>
<span class="kw">plot</span>(p.values, <span class="dt">main =</span> <span class="st">"Manhattan plot"</span>, 
     <span class="dt">xlab =</span> <span class="st">"Locus id"</span>, 
     <span class="dt">ylab =</span> <span class="st">"-log10(P-values)"</span>,
     <span class="dt">cex =</span> .<span class="dv">3</span>, <span class="dt">col =</span> <span class="st">"grey"</span>)
<span class="kw">points</span>(candidates, -<span class="kw">log10</span>(p.values)[candidates], 
       <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">cex =</span> .<span class="dv">2</span>, <span class="dt">col =</span> <span class="st">"blue"</span>)</code></pre></div>
<p><img src="/home/cayek/KrakenatorHomeDir/Projects/TESS3_encho_sen/docs/articles/main-vignette_files/figure-html/G.plot3-1.png" width="672"></p>
<p>Note that the significance values are displayed on a log scale. The <strong>p.values</strong> object can also be analyzed with other packages such as the useful <strong>qvalue</strong> package (Bioconductor).</p>
</div>
</div>
<div id="multi-allelic-data" class="section level4">
<h4>Multi-allelic data</h4>
<p>The <strong>tess3r</strong> package is not restricted to SNP data sets, and it can provide analyses of population genetic structure for data sets imported from the STRUCTURE or the TESS formats. In this section, we consider an example for simulated microsatellite markers. The data were generated by using a spatially explicit coalescent simulator, and they were analyzed using TESS 2.3 in (Durand et al. 2009).</p>
<p>After an initial phase of divergence, a species started to colonize Europe from two distant southern refugia, one in the Iberian peninsula and the other one in Turkey. Secondary contact occurred in Central Europe, in an area close to Germany. The data consists of 60 population samples of 10 diploid individuals that were genotyped at 100 markers. The data can be loaded and converted as follows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(durand09)
d09tess3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/tess2tess3.html">tess2tess3</a></span>(durand09, <span class="dt">FORMAT =</span> <span class="dv">2</span>, <span class="dt">diploid =</span> T, <span class="dt">extra.column =</span> <span class="dv">1</span>)</code></pre></div>
<pre><code>## Input file in the TESS format. The genotypic matrix has 600 individuals and 100 markers. 
## The number of extra rows is 0 and the number of extra columns is 1 .
## The input file contains no missing genotypes.</code></pre>
<p>The <strong>tess2tess3</strong> function converts the data in a binary format suitable for tess3, considering each allele as a distinct marker. A boolean value set to <strong>TESS = TRUE</strong> indicates the TESS format is used (default value). In the TESS format, geographic coordinates (longitude, latitude) are placed at the left to the genotypic matrix. <strong>FORMAT</strong> is an integer value equal to 1 for markers encoded using one row of data for each individual, and 2 for markers encoded using two rows of data for each individual. Once the file is converted to the binary format, <strong>tess3</strong> runs as with the SNP genotypes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">obj.d09 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/tess3.html">tess3</a></span>(<span class="dt">X =</span> d09tess3$X, <span class="dt">coord =</span> d09tess3$coord,
             <span class="dt">K =</span> <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">ploidy =</span> <span class="dv">2</span>, <span class="dt">openMP.core.num =</span> <span class="dv">4</span>)
<span class="kw">plot</span>(obj.d09, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="st">"blue"</span>,
     <span class="dt">xlab =</span> <span class="st">"Number of ancestral populations"</span>,
     <span class="dt">ylab =</span> <span class="st">"Cross-Validation score"</span>)</code></pre></div>
<p><img src="/home/cayek/KrakenatorHomeDir/Projects/TESS3_encho_sen/docs/articles/main-vignette_files/figure-html/STRplots2-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Q.matrix &lt;-<span class="st"> </span><span class="kw"><a href="../reference/qmatrix.html">qmatrix</a></span>(obj.d09, <span class="dt">K =</span> <span class="dv">3</span>)</code></pre></div>
<p>The ancestry coefficient matrix can be displayed as follows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barplot</span>(Q.matrix, <span class="dt">sort.by.Q =</span> <span class="ot">FALSE</span>, 
        <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">space =</span> <span class="dv">0</span>,
        <span class="dt">col.palette =</span> my.palette,
        <span class="dt">xlab =</span> <span class="st">"Individuals"</span>, <span class="dt">ylab =</span> <span class="st">"Ancestry coefficients"</span>) -&gt;<span class="st"> </span>bp</code></pre></div>
<p><img src="/home/cayek/KrakenatorHomeDir/Projects/TESS3_encho_sen/docs/articles/main-vignette_files/figure-html/STRplots3-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(Q.matrix, d09tess3$coord, <span class="dt">method =</span> <span class="st">"map.max"</span>, <span class="dt">cex =</span> .<span class="dv">5</span>,  
     <span class="dt">interpol =</span> <span class="kw"><a href="../reference/FieldsKrigModel.html">FieldsKrigModel</a></span>(<span class="dv">10</span>), 
     <span class="dt">main =</span> <span class="st">"Ancestry coefficients"</span>,
     <span class="dt">resolution =</span> <span class="kw">c</span>(<span class="dv">500</span>, <span class="dv">500</span>),
     <span class="dt">col.palette =</span> my.palette,
     <span class="dt">xlab =</span> <span class="st">"Longitude"</span>, <span class="dt">ylab =</span> <span class="st">"Latitude"</span>)</code></pre></div>
<p><img src="/home/cayek/KrakenatorHomeDir/Projects/TESS3_encho_sen/docs/articles/main-vignette_files/figure-html/STRplots3-2.png" width="672"></p>
</div>
<div id="package-reference" class="section level4">
<h4>Package reference</h4>
<ul><li>Caye K, Jay F, Michel O, Francois O (2016). Fast inference of individual admixture coefficients using geographic data.</li>
</ul></div>
<div id="references" class="section level4">
<h4>References</h4>
<ul><li><p>Alexander DH, Lange K (2011). Enhancements to the ADMIXTURE algorithm for individual ancestry estimation. BMC Bioinformatics 12, 246.</p></li>
<li><p>Atwell S, Huang YS, Vilhjalmsson BJ, et al. (2010). Genome-wide association study of 107 phenotypes in Arabidopsis thaliana inbred lines. Nature 465, 627-631.</p></li>
<li><p>Caye K, Deist TM, Martins H, Michel O, Francois O (2016). TESS3: Fast inference of spatial population structure and genome scans for selection. Molecular Ecology Resources 16, 540-548.</p></li>
<li><p>Chen C, Durand E, Forbes F, Francois O (2007). Bayesian clustering algorithms ascertaining spatial population structure: A new computer program and a comparison study. Molecular Ecology Notes 7, 747-756.</p></li>
<li><p>Durand E, Jay F, Gaggiotti OE, Francois O (2009). Spatial inference of admixture proportions and secondary contact zones. Molecular Biology and Evolution 26(9), 1963-1973.</p></li>
<li><p>Francois O, Durand E (2010). Spatially explicit Bayesian clustering models in population genetics. Molecular Ecology Resources 10, 773-784.</p></li>
<li><p>Francois O, Martins H, Caye K, Schoville SD (2016). Controlling false discoveries in genome scans for selection. Molecular Ecology 25, 454-469.</p></li>
<li><p>Frichot E, Francois O (2015). LEA: an R package for Landscape and Ecological Association studies. Methods in Ecology and Evolution 6(8), 925-929.</p></li>
<li><p>Frichot E, Mathieu F, Trouillon T, Bouchard G, Francois O (2014). Fast and efficient estimation of individual ancestry coefficients. Genetics 196, 973-983.</p></li>
<li><p>Martins H, Caye K, Luu K, Blum MG, Francois O (2016). Identifying outlier loci in admixed and in continuous populations using ancestral population differentiation statistics. Molecular Ecology, (bioRxiv, 054585).</p></li>
<li><p>Pritchard JK, Stephens M, Donnelly P (2000). Inference of population structure using multilocus genotype data. Genetics 155(2), 945-959.</p></li>
</ul></div>
  </div>

  <div class="col-md-3 hidden-xs">
      </div>

</div>


      <footer><p>Built by <a href="http://hadley.github.io/pkgdown/">pkgdown</a>. Styled with <a href="http://getbootstrap.com">Bootstrap 3</a>.</p>
      </footer></div>

  </body></html>
